@model List<SofiaCosmetics.Models.ViewModels.WishlistItem>
@{
    ViewBag.Title = "Sản phẩm yêu thích";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container py-5">
    <h2 class="fw-bold text-pink mb-4"><i class="lni lni-heart"></i> Sản phẩm yêu thích</h2>

    @if (Model != null && Model.Any())
    {
        <div class="row">
            @foreach (var sp in Model)
            {
                <div class="col-md-3 mb-4">
                    <div class="card shadow-sm border-0 rounded-3">
                        <img src="@Url.Content(sp.HinhAnh)"
                             class="card-img-top" style="height:220px;object-fit:cover;" />
                        <div class="card-body text-center">
                            <h6 class="fw-semibold">@sp.TenSP</h6>
                            <p class="text-danger fw-bold mb-2">@String.Format("{0:N0}₫", sp.Gia)</p>

                            <a href="@Url.Action("ChiTietSP", "Home", new { id = sp.MaSP })"
                               class="btn btn-outline-pink btn-sm rounded-pill px-3">Xem chi tiết</a>

                            <a href="@Url.Action("Xoa", "Wishlist", new { id = sp.MaSP })"
                               class="btn btn-outline-danger btn-sm rounded-pill px-3 ms-2">Xóa</a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="text-end mt-3">
            <a href="@Url.Action("XoaTatCa", "Wishlist")" class="btn btn-outline-danger">Xóa tất cả</a>
        </div>
    }
    else
    {
        <p class="text-muted">💔 Bạn chưa yêu thích sản phẩm nào.</p>
    }
</div>
<!-- jQuery + Toastr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script>
$(document).ready(function () {
    $("#btnWishlist").click(function () {
        var id = $(this).data("product-id");
        var btn = $(this);

        $.ajax({
            url: '@Url.Action("ThemYeuThich", "Wishlist")',
            type: "GET",
            data: { id: id },
            success: function (res) {
                if (res.success) {
                    toastr.success("Đã thêm vào danh sách yêu thích 💖");

                    // Đổi màu và chữ
                    btn.removeClass("btn-outline-pink").addClass("btn-pink");
                    $("#wishlistText").text("Đã yêu thích");
                    btn.find("i").removeClass("lni-heart").addClass("lni-heart-filled");
                } else {
                    toastr.warning(res.message || "Sản phẩm đã có trong danh sách yêu thích!");
                }
            },
            error: function () {
                toastr.error("Lỗi kết nối đến máy chủ!");
            }
        });
    });
});
</script>

